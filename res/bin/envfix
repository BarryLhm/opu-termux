#!/data/data/com.termux/files/usr/bin/zsh -eu

. /runtime/res/common.zsh "$0"

## fix dns list
msg "$(M envfix.dns)"
DNSLIST="/etc/resolv.conf"
#[ ! -L "$DNSLIST" ] || \
{
	[ ! -f "$DNSLIST" ] || print_run rm "$DNSLIST"
	for i in "223.5.5.5" "114.114.114.114"
	do	msg "$(M envfix.dns.write $i)"
		echo "nameserver $i" >> "$DNSLIST"
	done
}

### fix sources
msg "$(M envfix.repo)"
SRCLIST="/etc/apt/sources.list"
[ ! -f "$SRCLIST" ] || print_run mv "$SRCLIST" "$SRCLIST.bak"
cat <<-EOF > "$SRCLIST.d/ubuntu.sources"
	Types: deb
	URIs: $DB_MIRROR
	Suites: $DB_SUITE $DB_SUITE-updates $DB_SUITE-security \
		$DB_SUITE-backports $DB_SUITE-proposed
	Components: main universe multiverse restricted
	Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg
EOF

## install packages
package sync
package up
package add "dotnet-runtime-8.0" "libx11-6" "libice6" "libsm6" \
  "fontconfig" "fonts-noto-ui-core" "fonts-noto-cjk" \
  "libgl1" "dbus-x11" "xfwm4" "xfce4-panel" "libpulse0" "language-pack-zh-hans"

## generate locales

cat <<-EOF > /etc/locale.gen
zh_CN.UTF-8 UTF-8
C.UTF-8 UTF-8
EOF

locale-gen
